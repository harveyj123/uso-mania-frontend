/*!
 * @pixi/canvas-renderer - v6.3.2
 * Compiled Wed, 04 May 2022 17:49:13 UTC
 *
 * @pixi/canvas-renderer is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@pixi/core"),t=require("@pixi/utils"),r=require("@pixi/math"),o=require("@pixi/constants"),i=require("@pixi/settings"),n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},n(e,t)};var a=function(){function e(e){this._foundShapes=[],this.renderer=e}return e.prototype.pushMask=function(e){var t=this.renderer,r=e.maskObject||e;t.context.save();var o=this._foundShapes;if(this.recursiveFindShapes(r,o),o.length>0){var i=t.context;i.beginPath();for(var n=0;n<o.length;n++){var a=o[n],s=a.transform.worldTransform;this.renderer.setContextTransform(s),this.renderGraphicsShape(a)}o.length=0,i.clip()}},e.prototype.recursiveFindShapes=function(e,t){e.geometry&&e.geometry.graphicsData&&t.push(e);var r=e.children;if(r)for(var o=0;o<r.length;o++)this.recursiveFindShapes(r[o],t)},e.prototype.renderGraphicsShape=function(e){e.finishPoly();var t=this.renderer.context,o=e.geometry.graphicsData,i=o.length;if(0!==i)for(var n=0;n<i;n++){var a=o[n],s=a.shape;if(s.type===r.SHAPES.POLY){var h=s.points,l=a.holes,c=void 0,d=void 0,u=void 0,p=void 0;t.moveTo(h[0],h[1]);for(var E=1;E<h.length/2;E++)t.lineTo(h[2*E],h[2*E+1]);if(l.length>0){c=0,u=h[0],p=h[1];for(E=2;E+2<h.length;E+=2)c+=(h[E]-u)*(h[E+3]-p)-(h[E+2]-u)*(h[E+1]-p);for(var g=0;g<l.length;g++)if(h=l[g].shape.points){d=0,u=h[0],p=h[1];for(E=2;E+2<h.length;E+=2)d+=(h[E]-u)*(h[E+3]-p)-(h[E+2]-u)*(h[E+1]-p);if(d*c<0){t.moveTo(h[0],h[1]);for(E=2;E<h.length;E+=2)t.lineTo(h[E],h[E+1])}else{t.moveTo(h[h.length-2],h[h.length-1]);for(E=h.length-4;E>=0;E-=2)t.lineTo(h[E],h[E+1])}l[g].shape.closeStroke&&t.closePath()}}h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&t.closePath()}else if(s.type===r.SHAPES.RECT)t.rect(s.x,s.y,s.width,s.height),t.closePath();else if(s.type===r.SHAPES.CIRC)t.arc(s.x,s.y,s.radius,0,2*Math.PI),t.closePath();else if(s.type===r.SHAPES.ELIP){var D=2*s.width,v=2*s.height,S=s.x-D/2,_=s.y-v/2,f=.5522848,O=D/2*f,M=v/2*f,m=S+D,T=_+v,C=S+D/2,N=_+v/2;t.moveTo(S,N),t.bezierCurveTo(S,N-M,C-O,_,C,_),t.bezierCurveTo(C+O,_,m,N-M,m,N),t.bezierCurveTo(m,N+M,C+O,T,C,T),t.bezierCurveTo(C-O,T,S,N+M,S,N),t.closePath()}else if(s.type===r.SHAPES.RREC){var L=s.x,x=s.y,y=s.width,B=s.height,R=s.radius,b=Math.min(y,B)/2;R=R>b?b:R,t.moveTo(L,x+R),t.lineTo(L,x+B-R),t.quadraticCurveTo(L,x+B,L+R,x+B),t.lineTo(L+y-R,x+B),t.quadraticCurveTo(L+y,x+B,L+y,x+B-R),t.lineTo(L+y,x+R),t.quadraticCurveTo(L+y,x,L+y-R,x),t.lineTo(L+R,x),t.quadraticCurveTo(L,x,L,x+R),t.closePath()}}},e.prototype.popMask=function(e){e.context.restore(),e.invalidateBlendMode()},e.prototype.destroy=function(){},e}();function s(e){var t=document.createElement("canvas");t.width=6,t.height=1;var r=t.getContext("2d");return r.fillStyle=e,r.fillRect(0,0,6,1),t}function h(){if("undefined"==typeof document)return!1;var e=s("#ff00ff"),t=s("#ffff00"),r=document.createElement("canvas");r.width=6,r.height=1;var o=r.getContext("2d");o.globalCompositeOperation="multiply",o.drawImage(e,0,0),o.drawImage(t,2,0);var i=o.getImageData(2,0,1,1);if(!i)return!1;var n=i.data;return 255===n[0]&&0===n[1]&&0===n[2]}var l=new r.Matrix,c=function(r){function s(e){var i,n=r.call(this,o.RENDERER_TYPE.CANVAS,e)||this;if(n.refresh=!0,n.maskManager=new a(n),n.smoothProperty="imageSmoothingEnabled",n.blendModes=(void 0===i&&(i=[]),h()?(i[o.BLEND_MODES.NORMAL]="source-over",i[o.BLEND_MODES.ADD]="lighter",i[o.BLEND_MODES.MULTIPLY]="multiply",i[o.BLEND_MODES.SCREEN]="screen",i[o.BLEND_MODES.OVERLAY]="overlay",i[o.BLEND_MODES.DARKEN]="darken",i[o.BLEND_MODES.LIGHTEN]="lighten",i[o.BLEND_MODES.COLOR_DODGE]="color-dodge",i[o.BLEND_MODES.COLOR_BURN]="color-burn",i[o.BLEND_MODES.HARD_LIGHT]="hard-light",i[o.BLEND_MODES.SOFT_LIGHT]="soft-light",i[o.BLEND_MODES.DIFFERENCE]="difference",i[o.BLEND_MODES.EXCLUSION]="exclusion",i[o.BLEND_MODES.HUE]="hue",i[o.BLEND_MODES.SATURATION]="saturate",i[o.BLEND_MODES.COLOR]="color",i[o.BLEND_MODES.LUMINOSITY]="luminosity"):(i[o.BLEND_MODES.NORMAL]="source-over",i[o.BLEND_MODES.ADD]="lighter",i[o.BLEND_MODES.MULTIPLY]="source-over",i[o.BLEND_MODES.SCREEN]="source-over",i[o.BLEND_MODES.OVERLAY]="source-over",i[o.BLEND_MODES.DARKEN]="source-over",i[o.BLEND_MODES.LIGHTEN]="source-over",i[o.BLEND_MODES.COLOR_DODGE]="source-over",i[o.BLEND_MODES.COLOR_BURN]="source-over",i[o.BLEND_MODES.HARD_LIGHT]="source-over",i[o.BLEND_MODES.SOFT_LIGHT]="source-over",i[o.BLEND_MODES.DIFFERENCE]="source-over",i[o.BLEND_MODES.EXCLUSION]="source-over",i[o.BLEND_MODES.HUE]="source-over",i[o.BLEND_MODES.SATURATION]="source-over",i[o.BLEND_MODES.COLOR]="source-over",i[o.BLEND_MODES.LUMINOSITY]="source-over"),i[o.BLEND_MODES.NORMAL_NPM]=i[o.BLEND_MODES.NORMAL],i[o.BLEND_MODES.ADD_NPM]=i[o.BLEND_MODES.ADD],i[o.BLEND_MODES.SCREEN_NPM]=i[o.BLEND_MODES.SCREEN],i[o.BLEND_MODES.SRC_IN]="source-in",i[o.BLEND_MODES.SRC_OUT]="source-out",i[o.BLEND_MODES.SRC_ATOP]="source-atop",i[o.BLEND_MODES.DST_OVER]="destination-over",i[o.BLEND_MODES.DST_IN]="destination-in",i[o.BLEND_MODES.DST_OUT]="destination-out",i[o.BLEND_MODES.DST_ATOP]="destination-atop",i[o.BLEND_MODES.XOR]="xor",i[o.BLEND_MODES.SUBTRACT]="source-over",i),n.renderingToScreen=!1,n._activeBlendMode=null,n._projTransform=null,n._outerBlend=!1,n.rootContext=n.view.getContext("2d",{alpha:n.useContextAlpha}),n.context=n.rootContext,!n.rootContext.imageSmoothingEnabled){var l=n.rootContext;l.webkitImageSmoothingEnabled?n.smoothProperty="webkitImageSmoothingEnabled":l.mozImageSmoothingEnabled?n.smoothProperty="mozImageSmoothingEnabled":l.oImageSmoothingEnabled?n.smoothProperty="oImageSmoothingEnabled":l.msImageSmoothingEnabled&&(n.smoothProperty="msImageSmoothingEnabled")}return n.initPlugins(s.__plugins),t.sayHello("Canvas"),n.resize(n.options.width,n.options.height),n}return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(s,r),s.prototype.addSystem=function(){return this},s.prototype.render=function(r,i){if(this.view){var n,a,s,h;i&&(i instanceof e.RenderTexture||i instanceof e.BaseRenderTexture?(n=i,a=arguments[2],s=arguments[3],h=arguments[4]):(n=i.renderTexture,a=i.clear,s=i.transform,h=i.skipUpdateTransform)),this.renderingToScreen=!n,this.emit("prerender");var l=this.resolution;n?((n=n.castToBaseTexture())._canvasRenderTarget||(n._canvasRenderTarget=new t.CanvasRenderTarget(n.width,n.height,n.resolution),n.resource=new e.CanvasResource(n._canvasRenderTarget.canvas),n.valid=!0),this.context=n._canvasRenderTarget.context,this.resolution=n._canvasRenderTarget.resolution):this.context=this.rootContext;var c=this.context;if(this._projTransform=s||null,n||(this._lastObjectRendered=r),!h){var d=r.enableTempParent();r.updateTransform(),r.disableTempParent(d)}if(c.save(),c.setTransform(1,0,0,1,0,0),c.globalAlpha=1,this._activeBlendMode=o.BLEND_MODES.NORMAL,this._outerBlend=!1,c.globalCompositeOperation=this.blendModes[o.BLEND_MODES.NORMAL],void 0!==a?a:this.clearBeforeRender)if(this.renderingToScreen)c.clearRect(0,0,this.width,this.height),this.backgroundAlpha>0&&(c.globalAlpha=this.useContextAlpha?this.backgroundAlpha:1,c.fillStyle=this._backgroundColorString,c.fillRect(0,0,this.width,this.height),c.globalAlpha=1);else{(n=n)._canvasRenderTarget.clear();var u=n.clearColor;u[3]>0&&(c.globalAlpha=this.useContextAlpha?u[3]:1,c.fillStyle=t.hex2string(t.rgb2hex(u)),c.fillRect(0,0,n.realWidth,n.realHeight),c.globalAlpha=1)}var p=this.context;this.context=c,r.renderCanvas(this),this.context=p,c.restore(),this.resolution=l,this._projTransform=null,this.emit("postrender")}},s.prototype.setContextTransform=function(e,t,r){var o=e,i=this._projTransform,n=this.resolution;r=r||n,i&&((o=l).copyFrom(e),o.prepend(i)),t?this.context.setTransform(o.a*r,o.b*r,o.c*r,o.d*r,o.tx*n|0,o.ty*n|0):this.context.setTransform(o.a*r,o.b*r,o.c*r,o.d*r,o.tx*n,o.ty*n)},s.prototype.clear=function(e,t){void 0===e&&(e=this._backgroundColorString),void 0===t&&(t=this.backgroundAlpha);var r=this.context;r.clearRect(0,0,this.width,this.height),e&&(r.globalAlpha=this.useContextAlpha?t:1,r.fillStyle=e,r.fillRect(0,0,this.width,this.height),r.globalAlpha=1)},s.prototype.setBlendMode=function(e,t){var r=e===o.BLEND_MODES.SRC_IN||e===o.BLEND_MODES.SRC_OUT||e===o.BLEND_MODES.DST_IN||e===o.BLEND_MODES.DST_ATOP;!t&&r&&(e=o.BLEND_MODES.NORMAL),this._activeBlendMode!==e&&(this._activeBlendMode=e,this._outerBlend=r,this.context.globalCompositeOperation=this.blendModes[e])},s.prototype.destroy=function(e){r.prototype.destroy.call(this,e),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},s.prototype.resize=function(e,t){r.prototype.resize.call(this,e,t),this.smoothProperty&&(this.rootContext[this.smoothProperty]=i.settings.SCALE_MODE===o.SCALE_MODES.LINEAR)},s.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},s.registerPlugin=function(e,t){s.__plugins=s.__plugins||{},s.__plugins[e]=t},s}(e.AbstractRenderer),d={canvas:null,getTintedCanvas:function(e,t){var r=e.texture,o="#"+("00000"+(0|(t=d.roundColor(t))).toString(16)).slice(-6);r.tintCache=r.tintCache||{};var i,n=r.tintCache[o];if(n){if(n.tintId===r._updateID)return r.tintCache[o];i=r.tintCache[o]}else i=document.createElement("canvas");if(d.tintMethod(r,t,i),i.tintId=r._updateID,d.convertTintToImage){var a=new Image;a.src=i.toDataURL(),r.tintCache[o]=a}else r.tintCache[o]=i;return i},getTintedPattern:function(e,t){var r="#"+("00000"+(0|(t=d.roundColor(t))).toString(16)).slice(-6);e.patternCache=e.patternCache||{};var o=e.patternCache[r];return o&&o.tintId===e._updateID||(d.canvas||(d.canvas=document.createElement("canvas")),d.tintMethod(e,t,d.canvas),(o=d.canvas.getContext("2d").createPattern(d.canvas,"repeat")).tintId=e._updateID,e.patternCache[r]=o),o},tintWithMultiply:function(e,t,r){var o=r.getContext("2d"),i=e._frame.clone(),n=e.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),o.save(),o.fillStyle="#"+("00000"+(0|t).toString(16)).slice(-6),o.fillRect(0,0,i.width,i.height),o.globalCompositeOperation="multiply";var a=e.baseTexture.getDrawableSource();o.drawImage(a,i.x,i.y,i.width,i.height,0,0,i.width,i.height),o.globalCompositeOperation="destination-atop",o.drawImage(a,i.x,i.y,i.width,i.height,0,0,i.width,i.height),o.restore()},tintWithOverlay:function(e,t,r){var o=r.getContext("2d"),i=e._frame.clone(),n=e.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),o.save(),o.globalCompositeOperation="copy",o.fillStyle="#"+("00000"+(0|t).toString(16)).slice(-6),o.fillRect(0,0,i.width,i.height),o.globalCompositeOperation="destination-atop",o.drawImage(e.baseTexture.getDrawableSource(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),o.restore()},tintWithPerPixel:function(e,r,o){var i=o.getContext("2d"),n=e._frame.clone(),a=e.baseTexture.resolution;n.x*=a,n.y*=a,n.width*=a,n.height*=a,o.width=Math.ceil(n.width),o.height=Math.ceil(n.height),i.save(),i.globalCompositeOperation="copy",i.drawImage(e.baseTexture.getDrawableSource(),n.x,n.y,n.width,n.height,0,0,n.width,n.height),i.restore();for(var s=t.hex2rgb(r),h=s[0],l=s[1],c=s[2],d=i.getImageData(0,0,n.width,n.height),u=d.data,p=0;p<u.length;p+=4)u[p+0]*=h,u[p+1]*=l,u[p+2]*=c;i.putImageData(d,0,0)},roundColor:function(e){var r=d.cacheStepsPerColorChannel,o=t.hex2rgb(e);return o[0]=Math.min(255,o[0]/r*r),o[1]=Math.min(255,o[1]/r*r),o[2]=Math.min(255,o[2]/r*r),t.rgb2hex(o)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:h(),tintMethod:null};d.tintMethod=d.canUseMultiply?d.tintWithMultiply:d.tintWithPerPixel;var u=e.Renderer.create;e.Renderer.create=function(e){if(!(e&&e.forceCanvas))try{return u(e)}catch(e){}return new c(e)},e.BaseTexture.prototype.getDrawableSource=function(){var e=this.resource;return e?e.bitmap||e.source:null},e.BaseRenderTexture.prototype._canvasRenderTarget=null,e.Texture.prototype.patternCache=null,e.Texture.prototype.tintCache=null,exports.CanvasRenderer=c,exports.canUseNewCanvasBlendModes=h,exports.canvasUtils=d;
//# sourceMappingURL=canvas-renderer.min.js.map
